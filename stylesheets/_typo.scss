//  _                                           _
// | |                                         | |
// | |_ _   _ _ __   ___   __ _ _ __ __ _ _ __ | |__  _   _
// | __| | | | '_ \ / _ \ / _` | '__/ _` | '_ \| '_ \| | | |
// | |_| |_| | |_) | (_) | (_| | | | (_| | |_) | | | | |_| |
//  \__|\__, | .__/ \___/ \__, |_|  \__,_| .__/|_| |_|\__, |
//       __/ | |           __/ |         | |           __/ |
//      |___/|_|          |___/          |_|          |___/

///////////
// FONTS //
///////////

$fonts: (
  default (
    definition (
      font-family ('Helvetica Neue' Helvetica sans-serif),
      letter-spacing 0.0125em
    ),
    metrics (
      size-modifier 1,
      capline (50 0.125, 200 0.2),
      baseline (50 0.175, 200 0.25)
    )
  )
) !default;

// font-face declarations
// TODO: get the newer IE9+ version of this
@mixin font-face($family, $file, $style: normal, $weight: normal, $path: $typo-font-path) {
  @font-face {
    font-family: $family;
    font-style: $style;
    font-weight: $weight; // this should be both word and number values
    src: url('#{$path}#{$file}.eot'); // IE9 Compat Modes
    src: url('#{$path}#{$file}.eot?#iefix') format('embedded-opentype'),
       url('#{$path}#{$file}.woff') format('woff'),
       url('#{$path}#{$file}.svg##{$file}') format('svg'),
       url('#{$path}#{$file}.ttf') format('truetype');
  }
}


/////////////
// GLOBALS //
/////////////

$t_current-size: null !default;
$t_current-height: null !default;
$t_min-height: 1.125 !default;
$t_line-div: 2 !default;

$t_pre: 't_' !default;
$t_single-class: 'single' !default;
$t_block-class: 'block' !default;
$t_container-class: 'contain' !default;


///////////
// MIXIN //
///////////

@mixin typo($size: 0, $height: auto){
  $size: if(unitless($size), size($size), if(unit($size) == 'px', rem($size), $size));
  @if $height == 'auto' {
    $line-div: $t_line-div or ceil($size);
    $rel-height: medium-value('line-height') / strip($size);
    $height: $rel-height * ceil($t_min-height / $rel-height * $t_line-div) / $t_line-div;
    $trim: (1 - $height) / 2;
  }

  font-size: $size;
  line-height: $height;
  margin-top: 0;
  margin-bottom: 0;

  $t_current-size: $size !global;
  $t_current-height: $height !global;

  &.#{$t_pre}#{$t_single-class}, [typo~='#{$t_single-class}'] {
    line-height: 1;
  }
  &.#{$t_pre}#{$t_block-class}, &[typo~='#{$t_block-class}'] {
    margin-top: margin-t(0rem);
    margin-bottom: margin-t(0rem);
  }
  .#{$t_pre}#{$t_container-class} &, [typo~='#{$t_container-class}'] & {
    @content;
    &:first-child { margin-top: margin-t(0rem); }
  }

  $t_current-size: null !global;
  $t_current-height: null !global;
}

// alias
@mixin t($args...) { @include typo($args...) { @content; } }

///////////////
// FUNCTIONS //
///////////////

@function line-trim($line-height: null){
  $line-height: $line-height or $t_current-height or medium-value('line-height');
  @return ($line-height - 1em) / 2;
}

@function typo-margin($margin, $line-height: null){
  $margin: if(unitless($margin), margin-y($margin), $margin);
  @if strip($margin) == 0 { @return - line-trim($line-height); }
  @return calc(#{$margin} - #{line-trim($line-height)});
}

// aliases
@function t-margin($args...) { @return typo-margin($args...); }
@function margin-t($args...) { @return typo-margin($args...); }
