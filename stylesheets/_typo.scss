//  _                                           _
// | |                                         | |
// | |_ _   _ _ __   ___   __ _ _ __ __ _ _ __ | |__  _   _
// | __| | | | '_ \ / _ \ / _` | '__/ _` | '_ \| '_ \| | | |
// | |_| |_| | |_) | (_) | (_| | | | (_| | |_) | | | | |_| |
//  \__|\__, | .__/ \___/ \__, |_|  \__,_| .__/|_| |_|\__, |
//       __/ | |           __/ |         | |           __/ |
//      |___/|_|          |___/          |_|          |___/

/////////////
// GLOBALS //
/////////////

$typo-current-size: null;
$typo-current-height: null;
$typo-min-height: 1.125;
$typo-line-div: 2;

///////////
// MIXIN //
///////////

@mixin typo($size, $height: auto){
  $size: if(unit($size) == 'px', rem($size), $size);
  @if $height == 'auto' {
    $line-div: $typo-line-div or ceil($size);
    $rel-height: medium-value('line-height') / strip($size);
    $height: $rel-height * ceil($typo-min-height / $rel-height * $typo-line-div) / $typo-line-div;
    $trim: (1 - $height) / 2;
  }
  $typo-current-size: $size !global;
  $typo-current-height: $height !global;
  font-size: $size;
  line-height: $height;
  @content;
  $typo-current-size: null !global;
  $typo-current-height: null !global;
}

///////////////
// FUNCTIONS //
///////////////

@function margin-x($index: 1, $basis: 10) {
  $factor: medium-value('margin-x-mod');
  $spread: ceil($basis/6);
  @return if($index == 0, 0rem, pow($factor, ($index - 1)/$spread) * medium-value('margin-x'));
}

@function margin-y($index: 1, $basis: 10) {
  $factor: medium-value('margin-y-mod');
  $spread: ceil($basis/6);
  @return if($index == 0, 0rem, pow($factor, ($index - 1)/$spread) * medium-value('margin-y'));
}

@function size($index: 1, $basis: 10) {
  $factor: medium-value('font-size-mod');
  $spread: ceil($basis/6);
  @return if($index == 0, 0rem, pow($factor, ($index - 1)/$spread) * medium-value('font-size'));
}

@function typo-margin($margin, $line-height: null){
  $margin: if(unitless($margin), margin-y($margin), $margin);
  $line-height: $line-height or $typo-current-height or medium-value('line-height');
  @return calc(#{$margin} - #{($line-height - 1em)/2});
}
// alias
@function t-margin($args...) { @return typo-margin($args...); }
@function margin-t($args...) { @return typo-margin($args...); }