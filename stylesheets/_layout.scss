//  _                         _
// | |                       | |
// | | __ _ _   _  ___  _   _| |_
// | |/ _` | | | |/ _ \| | | | __|
// | | (_| | |_| | (_) | |_| | |_
// |_|\__,_|\__, |\___/ \__,_|\__|
//           __/ |
//          |___/

// TODO: new syntax

// // PAGE
// .l-page {}
// .l-page-top {}
// .l-page-right {}
// .l-page-bottom {}
// .l-page-left {}
// .l-page-x, .l-page-col {}
// .l-page-y, .l-page-sect {}

// // WRAP
// .l-wrap {}
// .l-wrap-each {}
// .l-wrap-alpha {}
// .l-wrap-from-alpha {}
// .l-wrap-to-delta {}

// // GRID
// .l-sect {}
// .l-sect-page, .l-page-sect {}
// .l-row {}
// .l-row-page, .l-page-row {}
// .l-col {}
// .l-col-page, .l-page-col {}

/////////////
// GLOBALS //
/////////////

// layout classes
$l-pre: 'l-' !default;
$l-page-class: 'page' !default;
$l-wrap-class: 'wrap' !default;
$l-sect-class: 'sect' !default;
$l-wrap-align: false !default; // right | left | false

// grid classes
$g-pre: 'g-' !default;
$g-grid-class: 'row' !default;
$g-pad-class: 'pad' !default;
$g-cell-class: 'col' !default;
$g-row-align: left !default; // right | left
$g-use-float: false !default; // true | false

// default values, if $media not present
$l-margin-x: 1rem !default;
$l-margin-y: 1rem !default;
$l-page-top: 1rem !default;
$l-page-right: 1rem !default;
$l-page-bottom: 1rem !default;
$l-page-left: 1rem !default;

/////////////////
// GRID MIXINS //
/////////////////

@mixin row-size($cols) { &::before { content: '#{$cols} .#{$g-pre}#{$g-cell-class}'; } }
// alias
@mixin row-width($args...) { @include row-size($args...); }

@mixin row-set($args...) {
  @extend .#{$g-pre}#{$g-grid-class};
  @if length($args) > 0 { @include row-size($args...); }
}

@mixin col-size($span: 1 1, $right: null, $left: null, $cycle: null, $out: null) {
  @if type-of($span) == 'map' { @include col-size($span...); } @else {

  $n: nth($span, 1); $d: nth($span, 2);
  width: $n / $d * 100%;

  @if $right { margin-right: nth($right, 1) / if(length($right) > 1, nth($right, 2), $d) * 100%; }
  @if $left { margin-left: nth($left, 1) / if(length($left) > 1, nth($left, 2), $d) * 100%; }
  @if $cycle { &:nth-child(#{$cycle}n+1) { clear: left; } }
  @else if $out { position: absolute; #{opposite($out)}: 100%; }

  }
}
// alias
@mixin col-width($args...) { @include col-size($args...); }
@mixin width($args...) { @include col-size($args...); }


@mixin col-set($args...) {
  @extend .#{$g-pre}#{$g-cell-class};
  @if length($args) > 0 { @include col-size($args...); }
}

/////////////////
// SETUP MIXIN //
/////////////////

@mixin parse-layouts($output: true){

  $margin-x: $l-margin-x;
  $margin-y: $l-margin-y;
  $page-top: $l-page-top;
  $page-right: $l-page-right;
  $page-bottom: $l-page-bottom;
  $page-left: $l-page-left;

  @if $output {

    // get dimensions from '$base' if it exists
    @if variable-exists('base') {
      $margin-x: get($base, 'margin-x');
      $margin-y: get($base, 'margin-y');
      $page-top: get($base, 'page-top');
      $page-right: get($base, 'page-right');
      $page-bottom: get($base, 'page-bottom');
      $page-left: get($base, 'page-left');
    }

    // PAGE
    .#{$l-pre}#{$l-page-class}_top { padding-top: $page-top; }
    .#{$l-pre}#{$l-page-class}_right { padding-right: $page-right; }
    .#{$l-pre}#{$l-page-class}_bottom { padding-bottom: $page-bottom; }
    .#{$l-pre}#{$l-page-class}_left { padding-left: $page-left; }
    .#{$l-pre}#{$l-page-class}_x {
      padding-left: $page-left;
      padding-right: $page-right;
    }
    .#{$l-pre}#{$l-page-class}_y {
      padding-top: $page-top;
      padding-bottom: $page-bottom;
    }

    // WRAP
    .#{$l-pre}#{$l-wrap-class},
    [class*="#{$l-pre}#{$l-wrap-class}_"],
    [class*="#{$l-pre}#{$l-wrap-class}--"] {
      @if $g-use-float { @include clearfix(); }
      @if $l-wrap-align != left { margin-left: auto; }
      @if $l-wrap-align != right { margin-right: auto; }
    }
    .#{$l-pre}#{$l-wrap-class}--left { @extend .#{$l-pre}#{$l-wrap-class}; margin-left: 0; }
    .#{$l-pre}#{$l-wrap-class}--right { @extend .#{$l-pre}#{$l-wrap-class}; margin-right: 0; }

    // SECT
    .#{$l-pre}#{$l-sect-class} {
      padding-top: $margin-y / 2;
      padding-bottom: $margin-y / 2;
    }

    // G-ROW
    .#{$g-pre}#{$g-grid-class} {
      &:before { display: none; }
      width: calc(100% + #{$margin-x}); // necessary?
      position: relative; // avoidable?
      margin-left: $margin-x / -2;
      margin-right: $margin-x / -2;
      @if $g-use-float {
        @include clearfix();
      } @else {
        font-size: 0rem;
        & > * { font-size: 1rem; }
      }
    }
    // G-PAD / COL
    .#{$g-pre}#{$g-pad-class},
    .#{$g-pre}#{$g-cell-class} {
      padding-left: $margin-x / 2;
      padding-right: $margin-x / 2;
    }

    // G-COL
    .#{$g-pre}#{$g-cell-class} {
      width: 100%;
      min-height: 1px; // http://css-tricks.com/make-sure-columns-dont-collapse-horizontally/
      @if $g-use-float {
        display: block;
        float: $g-row-align;
      } @else {
        display: inline-block;
        text-align: $g-row-align;
        vertical-align: top;
      }
    }

    @if variable-exists('media') {

      @each $alias, $medium in $media {
        $margin-x: get($medium, 'margin-x');
        $margin-y: get($medium, 'margin-y');
        $page-top: get($medium, 'page-top');
        $page-right: get($medium, 'page-right');
        $page-bottom: get($medium, 'page-bottom');
        $page-left: get($medium, 'page-left');

        @include medium($alias) {

          $orig: medium-orig();

          // PAGE
          .#{$l-pre}#{$l-page-class}_top { @if map-has-key($orig, 'page-top') { padding-top: $page-top; } }
          .#{$l-pre}#{$l-page-class}_right { @if map-has-key($orig, 'page-right') { padding-right: $page-right; } }
          .#{$l-pre}#{$l-page-class}_bottom { @if map-has-key($orig, 'page-bottom') { padding-bottom: $page-bottom; } }
          .#{$l-pre}#{$l-page-class}_left { @if map-has-key($orig, 'page-left') { padding-left: $page-left; } }
          .#{$l-pre}#{$l-page-class}_x {
            @if map-has-key($orig, 'page-left') { padding-left: $page-left; }
            @if map-has-key($orig, 'page-right') { padding-right: $page-right; }
          }
          .#{$l-pre}#{$l-page-class}_y {
            @if map-has-key($orig, 'page-top') { padding-top: $page-top; }
            @if map-has-key($orig, 'page-bottom') { padding-bottom: $page-bottom; }
          }

          // SECT
          @if map-has-key($orig, 'margin-y') {
            .#{$l-pre}#{$l-sect-class} {
              padding-top: $margin-y / 2;
              padding-bottom: $margin-y / 2;
            }
          }

          // WRAP
          $media-keys: map-keys($media);
          $wrap_to: (); $wrap_to_string: '_until--';
          $wrap_fr: (); $wrap_fr_string: '_from--';
          @each $alias in slice($media-keys, 1, index($media-keys, $alias)) {
            $wrap_fr: append($wrap_fr, unquote('.#{$l-pre}#{$l-wrap-class}#{$wrap_fr_string}#{$alias}'), 'comma'); }
          @each $alias in slice($media-keys, index($media-keys, $alias), length($media-keys)) {
            $wrap_to: append($wrap_to, unquote('.#{$l-pre}#{$l-wrap-class}#{$wrap_to_string}#{$alias}'), 'comma'); }
          .#{$l-pre}#{$l-wrap-class}_each,
          .#{$l-pre}#{$l-wrap-class}--#{$alias},
          #{$wrap_fr}, #{$wrap_to} {
            max-width: medium-value('content-width');
          }

          // GRID, CELL
          @if map-has-key($orig, 'margin-x') {
            .#{$g-pre}#{$g-grid-class} {
              width: calc(100% + #{$margin-x}); // necessary?
              margin-left: $margin-x / -2;
              margin-right: $margin-x / -2;
            }
            // G-PAD
            .#{$g-pre}#{$g-pad-class},
            .#{$g-pre}#{$g-cell-class} {
              padding-left: $margin-x / 2;
              padding-right: $margin-x / 2;
            }
          }
        }
      }
    }
  }

}
