///////////
// grids //
///////////

// grid
@mixin grid($mult: null, $cols: null, $cell: '*') {
  @if $cols and $cell != '*' { &:before { display: none; content: '#{$cols} #{$cell}'; } }
  $gutter: if($mult, margin-x($mult), null);
  display: block;
  width: if($gutter, calc(100% + #{$gutter}), null);
  margin-right: if($gutter, $gutter/-2, null);
  margin-left: if($gutter, $gutter/-2, null);
  position: relative;
  font-size: 0rem;
  & > #{$cell} {
    display: inline-block;
    direction: rtl;
    vertical-align: top;
    min-height: 1px; // http://css-tricks.com/make-sure-columns-dont-collapse-horizontally/
    font-size: 1rem;
    width: if($cols, 100%/$cols, 100%);
    padding-right: if($gutter, $gutter/2, null);
    padding-left: if($gutter, $gutter/2, null);
  }
}

// flex-grid
@mixin flex-grid($mult: null, $cols: null, $cell: '*') {
  $gutter: if($mult, margin-x($mult), null);
  display: flex;
  width: if($gutter, calc(100% + #{$gutter}), null);
  margin-right: if($gutter, $gutter/-2, null);
  margin-left: if($gutter, $gutter/-2, null);
  @if $cols { flex-wrap: wrap; }
  & > #{$cell} {
    flex: if($cols, 0 1 auto, 1 1 auto);
    width: if($cols, (100%/#{$cols}), 0%);
    padding-right: if($gutter, $gutter/2, null);
    padding-left: if($gutter, $gutter/2, null);
  }
}

///////////
// cells //
///////////

// master mixin
@mixin cell($span: null, $opts: null, $right: null, $left: null, $out: null) {
  @if type-of($opts) == 'map' { @include cell-span($span, $opts...); }
  @else {
    $n: nth($span, 1) or medium-value('type-columns') or 4;
    $d: _nth($span, 2) or medium-value('grid-columns') or 4;
    flex-grow: 0;
    width: $n / $d * 100%;
    @if $right { margin-right: nth($right, 1) / (_nth($right, 2) or $d) * 100%; }
    @if $left { margin-left: nth($left, 1) / (_nth($left, 2) or $d) * 100%; }
    @else if $out {
      $side: map-get($out, (left: right, right: left));
      position: absolute; #{($side)}: 100%; top: auto;
    }
  }
}

// span only
@mixin cell-span($span: null) {
  $n: nth($span, 1) or medium-value('type-columns') or 4;
  $d: _nth($span, 2) or medium-value('grid-columns') or 4;
  flex-grow: 0;
  width: $n / $d * 100%;
}

// push only
@mixin cell-push($opts: null, $right: null, $left: null, $out: null) {
  @if type-of($opts) == 'map' { @include cell-push($opts...); }
  @else {
    $d: medium-value('grid-columns') or 4;
    @if $right { margin-right: nth($right, 1) / (_nth($right, 2) or $d) * 100%; }
    @if $left { margin-left: nth($left, 1) / (_nth($left, 2) or $d) * 100%; }
    @else if $out {
      $side: map-get($out, (left: right, right: left));
      position: absolute; #{($side)}: 100%; top: auto;
    }
  }
}
